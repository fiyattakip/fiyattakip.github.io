<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>FiyatTakip - GerÃ§ek Fiyat KarÅŸÄ±laÅŸtÄ±rma</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css">
  <!-- Ãœcretsiz API'ler iÃ§in -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://unpkg.com/cheerio@1.0.0-rc.12/dist/cheerio.min.js"></script>
</head>

<body>
  <!-- LOGIN MODAL -->
  <div id="loginModal" class="modalWrap" aria-hidden="true">
    <div class="modalBack" id="loginBackdrop"></div>
    <div class="modalCard" role="dialog" aria-modal="true" aria-label="GiriÅŸ">
      <div class="modalTop">
        <div class="modalTitle">GiriÅŸ Yap</div>
        <button id="closeLogin" class="iconBtn" type="button" aria-label="Kapat">âœ•</button>
      </div>

      <div class="authTabs">
        <button id="tabLogin" class="btnGhost sm isActive" type="button">GiriÅŸ</button>
        <button id="tabRegister" class="btnGhost sm" type="button">KayÄ±t</button>
      </div>

      <div id="loginPane" class="authPane">
        <label class="lbl">E-posta</label>
        <input id="loginEmail" type="email" autocomplete="email" placeholder="ornek@mail.com" />
        <label class="lbl">Åifre</label>
        <input id="loginPass" type="password" autocomplete="current-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
        <div class="row">
          <button id="btnLogin" class="btnPrimary" type="button">GiriÅŸ Yap</button>
        </div>
      </div>

      <div id="registerPane" class="authPane hidden">
        <label class="lbl">E-posta</label>
        <input id="regEmail" type="email" autocomplete="email" placeholder="ornek@mail.com" />
        <label class="lbl">Åifre</label>
        <input id="regPass" type="password" autocomplete="new-password" placeholder="en az 6 karakter" />
        <label class="lbl">Åifre (Tekrar)</label>
        <input id="regPass2" type="password" autocomplete="new-password" placeholder="ÅŸifreyi tekrar yaz" />
        <div class="row">
          <button id="btnRegister" class="btnPrimary" type="button">KayÄ±t Ol</button>
        </div>
      </div>
    </div>
  </div>

  <!-- APP -->
  <div id="app" class="appShell">
    <header class="topbar">
      <div class="brand">
        <div class="logoDot"></div>
        <div class="brandText">FiyatTakip</div>
      </div>
      <div class="topbarActions">
        <button id="btnSearchMode" class="iconBtn" type="button" aria-label="Arama Modu">ğŸ”</button>
        <button id="btnRefresh" class="iconBtn" type="button" aria-label="Yenile">ğŸ”„</button>
      </div>
    </header>

    <main class="pages">
      <!-- ANA SAYFA -->
      <section id="page-home" class="page active">
        <div class="welcomeCard">
          <h1>En Ucuz FiyatÄ± Bul</h1>
          <p class="subtitle">Trendyol, Hepsiburada, n11 karÅŸÄ±laÅŸtÄ±rmalÄ±</p>
        </div>

        <div class="searchCard">
          <div class="searchRow">
            <input id="searchInput" type="text" placeholder="Ã–rn: iPhone 15, Nike ayakkabÄ±..." autocomplete="off" />
            <button id="btnSearch" class="iconBtn searchBtn" type="button">ğŸ”</button>
          </div>
          
          <div class="searchModeRow">
            <div class="modeTags">
              <span class="modeTag active" data-mode="fast">âš¡ HÄ±zlÄ±</span>
              <span class="modeTag" data-mode="detail">ğŸ” DetaylÄ±</span>
              <span class="modeTag" data-mode="ai">ğŸ¤– AI</span>
            </div>
            <div class="modeInfo" id="modeInfo">HÄ±zlÄ± mod: AnlÄ±k fiyat karÅŸÄ±laÅŸtÄ±rma</div>
          </div>
        </div>

        <!-- HÄ±zlÄ± BaÅŸlat -->
        <div class="quickSearch">
          <h3>HÄ±zlÄ± Aramalar</h3>
          <div class="quickTags">
            <span class="quickTag" data-query="iphone 15">ğŸ“± iPhone</span>
            <span class="quickTag" data-query="airpods">ğŸ§ AirPods</span>
            <span class="quickTag" data-query="nike ayakkabÄ±">ğŸ‘Ÿ Nike</span>
            <span class="quickTag" data-query="televizyon">ğŸ“º TV</span>
            <span class="quickTag" data-query="laptop">ğŸ’» Laptop</span>
          </div>
        </div>

        <!-- Son Aramalar -->
        <div id="recentSearches" class="recentCard">
          <h3>Son Aramalar</h3>
          <div class="recentList" id="recentList"></div>
        </div>
      </section>

      <!-- SONUÃ‡LAR SAYFASI -->
      <section id="page-results" class="page">
        <div class="pageHeader">
          <button class="backBtn" onclick="showPage('home')">â†</button>
          <h2 id="resultTitle">SonuÃ§lar</h2>
          <button id="btnSort" class="iconBtn" title="SÄ±rala">â‡…</button>
        </div>

        <div class="resultsInfo">
          <div class="infoRow">
            <span id="resultCount">0 Ã¼rÃ¼n bulundu</span>
            <span id="resultTime"></span>
          </div>
        </div>

        <!-- Filtreler -->
        <div class="filters">
          <select id="filterSite" class="filterSelect">
            <option value="all">TÃ¼m Siteler</option>
            <option value="trendyol">Trendyol</option>
            <option value="hepsiburada">Hepsiburada</option>
            <option value="n11">n11</option>
          </select>
          <select id="filterSort" class="filterSelect">
            <option value="price-asc">Fiyat (Artan)</option>
            <option value="price-desc">Fiyat (Azalan)</option>
            <option value="popular">PopÃ¼ler</option>
          </select>
        </div>

        <!-- SonuÃ§lar Listesi -->
        <div class="resultsContainer" id="resultsContainer">
          <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Fiyatlar Ã§ekiliyor...</p>
          </div>
        </div>
      </section>

      <!-- FAVORÄ°LER -->
      <section id="page-favorites" class="page">
        <div class="pageHeader">
          <h2>Favorilerim</h2>
          <button id="btnClearFavs" class="iconBtn" title="Temizle">ğŸ—‘ï¸</button>
        </div>
        <div id="favoritesList" class="favoritesContainer"></div>
      </section>

      <!-- AYARLAR -->
      <section id="page-settings" class="page">
        <div class="settingsCard">
          <h2>Ayarlar</h2>
          
          <div class="settingItem">
            <label>Arama Modu</label>
            <select id="settingSearchMode" class="settingSelect">
              <option value="fast">HÄ±zlÄ± (Ã–nerilen)</option>
              <option value="detail">DetaylÄ± (Daha fazla sonuÃ§)</option>
              <option value="ai">AI Destekli</option>
            </select>
          </div>

          <div class="settingItem">
            <label>Otomatik Favori</label>
            <label class="switch">
              <input type="checkbox" id="autoFav" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="settingItem">
            <label>Bildirimler</label>
            <label class="switch">
              <input type="checkbox" id="notifications" />
              <span class="slider"></span>
            </label>
          </div>

          <div class="settingItem">
            <label>KaranlÄ±k Tema</label>
            <label class="switch">
              <input type="checkbox" id="darkMode" checked />
              <span class="slider"></span>
            </label>
          </div>

          <button id="btnClearCache" class="btnGhost full">Ã–nbelleÄŸi Temizle</button>
          <button id="btnLogout" class="btnPrimary full">Ã‡Ä±kÄ±ÅŸ Yap</button>
        </div>
      </section>
    </main>

    <!-- ALT MENÃœ -->
    <nav class="bottomNav">
      <button class="navBtn active" data-page="home">
        <span class="navIcon">ğŸ </span>
        <span class="navLabel">Ana</span>
      </button>
      <button class="navBtn" data-page="results">
        <span class="navIcon">ğŸ”</span>
        <span class="navLabel">Ara</span>
      </button>
      <button class="navBtn" data-page="favorites">
        <span class="navIcon">â¤ï¸</span>
        <span class="navLabel">Favori</span>
      </button>
      <button class="navBtn" data-page="settings">
        <span class="navIcon">âš™ï¸</span>
        <span class="navLabel">Ayarlar</span>
      </button>
    </nav>
  </div>

  <!-- TOAST MESAJ -->
  <div id="toast" class="toast"></div>

  <!-- SCRIPTS -->
  <script type="module">
    // GitHub Pages iÃ§in CORS proxy desteÄŸi
    const CORS_PROXY = 'https://cors-anywhere.herokuapp.com/';
    
    // Ãœcretsiz API endpoint'leri
    const API_ENDPOINTS = {
      // Public CORS proxy Ã¼zerinden
      trendyol: (query) => `${CORS_PROXY}https://www.trendyol.com/sr?q=${encodeURIComponent(query)}`,
      hepsiburada: (query) => `${CORS_PROXY}https://www.hepsiburada.com/ara?q=${encodeURIComponent(query)}`,
      n11: (query) => `${CORS_PROXY}https://www.n11.com/arama?q=${encodeURIComponent(query)}`,
      
      // Alternatif: allorigins.win
      trendyolAlt: (query) => `https://api.allorigins.win/get?url=${encodeURIComponent(`https://www.trendyol.com/sr?q=${encodeURIComponent(query)}`)}`,
    };

    // Ana uygulama
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { 
      getAuth, 
      GoogleAuthProvider, 
      signInWithPopup,
      signOut,
      onAuthStateChanged 
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    
    // Firebase config (kendi config'ini kullan)
    const firebaseConfig = {
      apiKey: "AIzaSyBcXkVFQzB2XtxO7wqnbXhzM1Io54zCsBI",
      authDomain: "fiyattakip-ttoxub.firebaseapp.com",
      projectId: "fiyattakip-ttoxub",
      storageBucket: "fiyattakip-ttoxub.firebasestorage.app",
      messagingSenderId: "105868725844",
      appId: "1:105868725844:web:fc04f5a08e708916e727c1"
    };
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    
    // Uygulama state
    window.appState = {
      user: null,
      searchMode: 'fast',
      favorites: JSON.parse(localStorage.getItem('fiyattakip_favorites') || '[]'),
      recentSearches: JSON.parse(localStorage.getItem('fiyattakip_recent') || '[]'),
      results: []
    };
    
    // Sayfa yÃ¶nlendirme
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.navBtn').forEach(b => b.classList.remove('active'));
      
      const page = document.getElementById(`page-${pageId}`);
      const navBtn = document.querySelector(`.navBtn[data-page="${pageId}"]`);
      
      if (page) page.classList.add('active');
      if (navBtn) navBtn.classList.add('active');
      
      // Sayfaya Ã¶zel iÅŸlemler
      if (pageId === 'favorites') renderFavorites();
      if (pageId === 'home') renderRecentSearches();
    }
    
    // Toast mesajÄ±
    function showToast(message, type = 'info') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type}`;
      toast.style.display = 'block';
      
      setTimeout(() => {
        toast.style.display = 'none';
      }, 3000);
    }
    
    // Arama yap
    async function searchProducts(query, mode = 'fast') {
      if (!query.trim()) {
        showToast('LÃ¼tfen bir ÅŸey yazÄ±n', 'error');
        return;
      }
      
      showPage('results');
      document.getElementById('resultTitle').textContent = query;
      document.getElementById('resultsContainer').innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <p>Fiyatlar Ã§ekiliyor...</p>
        </div>
      `;
      
      // AramayÄ± kaydet
      saveRecentSearch(query);
      
      try {
        const startTime = Date.now();
        
        // FarklÄ± sitelerden paralel veri Ã§ek
        const [trendyolResults, hepsiburadaResults, n11Results] = await Promise.allSettled([
          scrapeTrendyol(query),
          scrapeHepsiburada(query),
          scrapeN11(query)
        ]);
        
        const allResults = [
          ...(trendyolResults.status === 'fulfilled' ? trendyolResults.value : []),
          ...(hepsiburadaResults.status === 'fulfilled' ? hepsiburadaResults.value : []),
          ...(n11Results.status === 'fulfilled' ? n11Results.value : [])
        ];
        
        const endTime = Date.now();
        const duration = ((endTime - startTime) / 1000).toFixed(1);
        
        // SonuÃ§larÄ± gÃ¶ster
        renderResults(allResults, query, duration);
        
      } catch (error) {
        console.error('Arama hatasÄ±:', error);
        showToast('Arama sÄ±rasÄ±nda hata oluÅŸtu', 'error');
        document.getElementById('resultsContainer').innerHTML = `
          <div class="errorState">
            <div>ğŸ˜• Hata OluÅŸtu</div>
            <p>LÃ¼tfen daha sonra tekrar deneyin</p>
            <button onclick="searchProducts('${query}')" class="btnPrimary">Tekrar Dene</button>
          </div>
        `;
      }
    }
    
    // Trendyol'dan veri Ã§ek
    async function scrapeTrendyol(query) {
      try {
        const url = API_ENDPOINTS.trendyolAlt(query);
        const response = await fetch(url);
        const data = await response.json();
        
        if (!data.contents) return [];
        
        // HTML'yi parse et
        const parser = new DOMParser();
        const doc = parser.parseFromString(data.contents, 'text/html');
        
        const products = [];
        const productElements = doc.querySelectorAll('.p-card-wrppr, [class*="product-card"]');
        
        productElements.forEach((el, index) => {
          if (index >= 5) return; // Ä°lk 5 Ã¼rÃ¼n
          
          try {
            const titleEl = el.querySelector('.prdct-desc-cntnr-name, .product-name');
            const priceEl = el.querySelector('.prc-box-dscntd, .product-price');
            const linkEl = el.querySelector('a');
            const imageEl = el.querySelector('img');
            
            if (titleEl && priceEl) {
              const title = titleEl.textContent?.trim() || '';
              const price = priceEl.textContent?.replace('TL', '').trim() || '';
              const link = linkEl?.href || '';
              const image = imageEl?.src || '';
              
              if (title && price) {
                products.push({
                  site: 'Trendyol',
                  title: title.substring(0, 60) + (title.length > 60 ? '...' : ''),
                  price: price,
                  link: link.startsWith('http') ? link : `https://www.trendyol.com${link}`,
                  image: image,
                  rating: Math.random() * 5 + 3, // Test iÃ§in
                  timestamp: new Date().toISOString()
                });
              }
            }
          } catch (e) {}
        });
        
        return products;
      } catch (error) {
        console.error('Trendyol hatasÄ±:', error);
        return [];
      }
    }
    
    // Hepsiburada'dan veri Ã§ek
    async function scrapeHepsiburada(query) {
      try {
        const url = `https://api.allorigins.win/get?url=${encodeURIComponent(`https://www.hepsiburada.com/ara?q=${encodeURIComponent(query)}`)}`;
        const response = await fetch(url);
        const data = await response.json();
        
        if (!data.contents) return [];
        
        const products = [];
        // Basit regex ile fiyat ve Ã¼rÃ¼n adÄ± Ã§ek
        const priceRegex = /"price":"([^"]+)"/g;
        const titleRegex = /"title":"([^"]+)"/g;
        
        let match;
        while ((match = priceRegex.exec(data.contents)) !== null && products.length < 5) {
          const titleMatch = titleRegex.exec(data.contents);
          if (titleMatch) {
            products.push({
              site: 'Hepsiburada',
              title: titleMatch[1].substring(0, 60),
              price: match[1].replace('TL', '').trim(),
              link: `https://www.hepsiburada.com/ara?q=${encodeURIComponent(query)}`,
              image: '',
              timestamp: new Date().toISOString()
            });
          }
        }
        
        return products;
      } catch (error) {
        console.error('Hepsiburada hatasÄ±:', error);
        return [];
      }
    }
    
    // n11'den veri Ã§ek
    async function scrapeN11(query) {
      try {
        const url = `https://api.allorigins.win/get?url=${encodeURIComponent(`https://www.n11.com/arama?q=${encodeURIComponent(query)}`)}`;
        const response = await fetch(url);
        const data = await response.json();
        
        if (!data.contents) return [];
        
        const products = [];
        // n11 iÃ§in basit parse
        const productRegex = /<h3 class="productName">([^<]+)<\/h3>.*?<ins>([^<]+)<\/ins>/gs;
        let match;
        
        while ((match = productRegex.exec(data.contents)) !== null && products.length < 5) {
          products.push({
            site: 'n11',
            title: match[1].trim().substring(0, 60),
            price: match[2].replace('TL', '').trim(),
            link: `https://www.n11.com/arama?q=${encodeURIComponent(query)}`,
            image: '',
            timestamp: new Date().toISOString()
          });
        }
        
        return products;
      } catch (error) {
        console.error('n11 hatasÄ±:', error);
        return [];
      }
    }
    
    // SonuÃ§larÄ± render et
    function renderResults(products, query, duration) {
      const container = document.getElementById('resultsContainer');
      const countElement = document.getElementById('resultCount');
      const timeElement = document.getElementById('resultTime');
      
      countElement.textContent = `${products.length} Ã¼rÃ¼n bulundu`;
      timeElement.textContent = `${duration}s`;
      
      if (products.length === 0) {
        container.innerHTML = `
          <div class="emptyState">
            <div class="emptyIcon">ğŸ˜•</div>
            <h3>ÃœrÃ¼n bulunamadÄ±</h3>
            <p>"${query}" iÃ§in sonuÃ§ bulunamadÄ±</p>
            <button onclick="showPage('home')" class="btnPrimary">Yeni Arama</button>
          </div>
        `;
        return;
      }
      
      // Fiyata gÃ¶re sÄ±rala
      products.sort((a, b) => {
        const priceA = parseFloat(a.price.replace(/[^\d,.]/g, '').replace(',', '.')) || 0;
        const priceB = parseFloat(b.price.replace(/[^\d,.]/g, '').replace(',', '.')) || 0;
        return priceA - priceB;
      });
      
      let html = '<div class="resultsGrid">';
      
      products.forEach((product, index) => {
        const isCheapest = index === 0;
        
        html += `
          <div class="productCard ${isCheapest ? 'cheapest' : ''}">
            ${isCheapest ? '<div class="cheapestBadge">ğŸ† En Ucuz</div>' : ''}
            <div class="productHeader">
              <span class="productSite ${product.site.toLowerCase()}">${product.site}</span>
              <button class="favBtn" onclick="toggleFavorite(${JSON.stringify(product).replace(/"/g, '&quot;')})">
                ${window.appState.favorites.some(f => f.link === product.link) ? 'â¤ï¸' : 'ğŸ¤'}
              </button>
            </div>
            <div class="productBody">
              <h4 class="productTitle">${product.title}</h4>
              <div class="productPrice">${product.price} TL</div>
            </div>
            <div class="productActions">
              <button class="btnPrimary sm" onclick="window.open('${product.link}', '_blank')">ÃœrÃ¼ne Git</button>
              <button class="btnGhost sm" onclick="copyToClipboard('${product.link}')">â§‰ Kopyala</button>
            </div>
          </div>
        `;
      });
      
      html += '</div>';
      container.innerHTML = html;
    }
    
    // Favorilere ekle/Ã§Ä±kar
    function toggleFavorite(product) {
      const index = window.appState.favorites.findIndex(f => f.link === product.link);
      
      if (index === -1) {
        window.appState.favorites.push(product);
        showToast('Favorilere eklendi', 'success');
      } else {
        window.appState.favorites.splice(index, 1);
        showToast('Favorilerden Ã§Ä±karÄ±ldÄ±', 'info');
      }
      
      localStorage.setItem('fiyattakip_favorites', JSON.stringify(window.appState.favorites));
      
      if (document.getElementById('page-favorites').classList.contains('active')) {
        renderFavorites();
      }
    }
    
    // Favorileri render et
    function renderFavorites() {
      const container = document.getElementById('favoritesList');
      
      if (window.appState.favorites.length === 0) {
        container.innerHTML = `
          <div class="emptyState">
            <div class="emptyIcon">â¤ï¸</div>
            <h3>HenÃ¼z favorin yok</h3>
            <p>ÃœrÃ¼nlerin yanÄ±ndaki kalp ikonuna tÄ±klayarak favorilere ekleyebilirsin</p>
          </div>
        `;
        return;
      }
      
      let html = '<div class="favoritesGrid">';
      
      window.appState.favorites.forEach(product => {
        html += `
          <div class="favoriteCard">
            <div class="favoriteHeader">
              <span class="siteBadge">${product.site}</span>
              <button class="removeFav" onclick="toggleFavorite(${JSON.stringify(product).replace(/"/g, '&quot;')})">âœ•</button>
            </div>
            <div class="favoriteBody">
              <h4>${product.title}</h4>
              <div class="favoritePrice">${product.price} TL</div>
              <div class="favoriteDate">${new Date(product.timestamp).toLocaleDateString('tr-TR')}</div>
            </div>
            <button class="btnPrimary full" onclick="window.open('${product.link}', '_blank')">ÃœrÃ¼ne Git</button>
          </div>
        `;
      });
      
      html += '</div>';
      container.innerHTML = html;
    }
    
    // Son aramalarÄ± kaydet
    function saveRecentSearch(query) {
      window.appState.recentSearches = window.appState.recentSearches.filter(q => q !== query);
      window.appState.recentSearches.unshift(query);
      window.appState.recentSearches = window.appState.recentSearches.slice(0, 5);
      
      localStorage.setItem('fiyattakip_recent', JSON.stringify(window.appState.recentSearches));
      renderRecentSearches();
    }
    
    // Son aramalarÄ± gÃ¶ster
    function renderRecentSearches() {
      const container = document.getElementById('recentList');
      
      if (window.appState.recentSearches.length === 0) {
        container.innerHTML = '<p class="muted">HenÃ¼z arama yapÄ±lmadÄ±</p>';
        return;
      }
      
      let html = '';
      window.appState.recentSearches.forEach(query => {
        html += `
          <div class="recentItem" onclick="searchProducts('${query}')">
            <span>ğŸ”</span>
            <span>${query}</span>
            <button class="recentRemove" onclick="event.stopPropagation(); removeRecentSearch('${query}')">âœ•</button>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }
    
    // Son aramadan Ã§Ä±kar
    function removeRecentSearch(query) {
      window.appState.recentSearches = window.appState.recentSearches.filter(q => q !== query);
      localStorage.setItem('fiyattakip_recent', JSON.stringify(window.appState.recentSearches));
      renderRecentSearches();
    }
    
    // Clipboard
    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
        showToast('Link kopyalandÄ±', 'success');
      } catch {
        showToast('Kopyalama baÅŸarÄ±sÄ±z', 'error');
      }
    }
    
    // Event listeners
    document.addEventListener('DOMContentLoaded', () => {
      // Arama butonu
      document.getElementById('btnSearch').addEventListener('click', () => {
        const query = document.getElementById('searchInput').value.trim();
        searchProducts(query, window.appState.searchMode);
      });
      
      // Enter ile arama
      document.getElementById('searchInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          document.getElementById('btnSearch').click();
        }
      });
      
      // HÄ±zlÄ± arama etiketleri
      document.querySelectorAll('.quickTag').forEach(tag => {
        tag.addEventListener('click', () => {
          const query = tag.dataset.query;
          document.getElementById('searchInput').value = query;
          searchProducts(query);
        });
      });
      
      // Arama modlarÄ±
      document.querySelectorAll('.modeTag').forEach(tag => {
        tag.addEventListener('click', () => {
          document.querySelectorAll('.modeTag').forEach(t => t.classList.remove('active'));
          tag.classList.add('active');
          
          window.appState.searchMode = tag.dataset.mode;
          const info = document.getElementById('modeInfo');
          
          switch(tag.dataset.mode) {
            case 'fast':
              info.textContent = 'HÄ±zlÄ± mod: AnlÄ±k fiyat karÅŸÄ±laÅŸtÄ±rma';
              break;
            case 'detail':
              info.textContent = 'DetaylÄ± mod: Daha fazla sonuÃ§ (yavaÅŸ)';
              break;
            case 'ai':
              info.textContent = 'AI mod: AkÄ±llÄ± arama Ã¶nerileri';
              break;
          }
        });
      });
      
      // Alt menÃ¼
      document.querySelectorAll('.navBtn').forEach(btn => {
        btn.addEventListener('click', () => {
          const page = btn.dataset.page;
          showPage(page);
        });
      });
      
      // Favorileri temizle
      document.getElementById('btnClearFavs')?.addEventListener('click', () => {
        if (confirm('TÃ¼m favorileri silmek istediÄŸine emin misin?')) {
          window.appState.favorites = [];
          localStorage.setItem('fiyattakip_favorites', '[]');
          renderFavorites();
          showToast('Favoriler temizlendi', 'info');
        }
      });
      
      // Cache temizle
      document.getElementById('btnClearCache')?.addEventListener('click', () => {
        localStorage.clear();
        window.appState.favorites = [];
        window.appState.recentSearches = [];
        showToast('Ã–nbellek temizlendi', 'success');
        location.reload();
      });
      
      // Ã‡Ä±kÄ±ÅŸ
      document.getElementById('btnLogout')?.addEventListener('click', () => {
        signOut(auth);
        showToast('Ã‡Ä±kÄ±ÅŸ yapÄ±ldÄ±', 'info');
      });
      
      // Firebase auth state
      onAuthStateChanged(auth, (user) => {
        window.appState.user = user;
        if (user) {
          showToast(`HoÅŸ geldin ${user.email}`, 'success');
        }
      });
      
      // BaÅŸlangÄ±Ã§ta son aramalarÄ± yÃ¼kle
      renderRecentSearches();
    });
    
    // PWA yÃ¼kleme
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(() => console.log('Service Worker kayÄ±tlÄ±'))
          .catch(err => console.log('SW kayÄ±t hatasÄ±:', err));
      });
    }
    
    // Global fonksiyonlar
    window.showPage = showPage;
    window.searchProducts = searchProducts;
    window.toggleFavorite = toggleFavorite;
    window.copyToClipboard = copyToClipboard;
  </script>
</body>
</html>
