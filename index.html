<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#1f4fff" />
  <title>Fiyat Takip</title>
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./icons/icon-192.png" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">Fiyat Takip</div>
      <div class="sub">Normal arama • AI arama • Görsel arama • Favori → otomatik takip</div>
    </div>

    <div class="topbar-actions">
      <button id="btnOpenAISettings" class="btn btn-ghost" title="AI Ayarları">
        <span class="ico">
          <!-- inline svg: sparkle -->
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2l1.2 4.2L17 8l-3.8 1.8L12 14l-1.2-4.2L7 8l3.8-1.8L12 2zm7 9l.8 2.7L22 15l-2.2 1.1L19 19l-.8-2.9L16 15l2.2-1.3L19 11zM5 11l.9 3L9 15l-3.1 1.3L5 19l-.9-2.7L2 15l2.1-1.1L5 11z"/></svg>
        </span>
        AI Ayar
      </button>

      <button id="btnLogout" class="btn btn-danger">Çıkış</button>
    </div>
  </header>

  <main class="container">
    <!-- LOGIN -->
    <section id="loginView" class="card hidden">
      <h2>Giriş</h2>
      <p class="muted">Favoriler ve takip için giriş yap.</p>

      <div class="row">
        <button id="btnClearCacheLogin" class="btn btn-ghost">
          Önbelleği Temizle
        </button>
      </div>

      <div class="grid2">
        <div>
          <label>E-posta</label>
          <input id="loginEmail" type="email" placeholder="ornek@mail.com" autocomplete="email">
        </div>
        <div>
          <label>Şifre</label>
          <input id="loginPass" type="password" placeholder="••••••••" autocomplete="current-password">
        </div>
      </div>

      <div class="row">
        <button id="btnLogin" class="btn btn-primary">Giriş Yap</button>
        <button id="btnGoogle" class="btn btn-ghost">
          <span class="ico">
            <svg viewBox="0 0 24 24"><path d="M21.35 11.1H12v2.9h5.35c-.23 1.3-1.52 3.8-5.35 3.8-3.22 0-5.85-2.66-5.85-5.9s2.63-5.9 5.85-5.9c1.83 0 3.06.78 3.76 1.45l2.56-2.46C16.96 3.48 14.73 2.2 12 2.2 6.98 2.2 2.9 6.3 2.9 11.9S6.98 21.6 12 21.6c6.35 0 8.45-4.45 8.45-6.75 0-.46-.05-.8-.1-1.15z"/></svg>
          </span>
          Google ile devam et
        </button>
      </div>

      <div id="loginErr" class="err hidden"></div>
    </section>

    <!-- APP -->
    <section id="appView" class="hidden">
      <section class="card">
        <div class="segbar" role="tablist" aria-label="Arama modları">
          <button class="seg active" data-tab="normal">Normal</button>
          <button class="seg" data-tab="ai">
            <span class="ico">
              <svg viewBox="0 0 24 24"><path d="M12 2l1.2 4.2L17 8l-3.8 1.8L12 14l-1.2-4.2L7 8l3.8-1.8L12 2zM19 11l.8 2.7L22 15l-2.2 1.1L19 19l-.8-2.9L16 15l2.2-1.3L19 11z"/></svg>
            </span>
            AI Arama
          </button>
          <button class="seg" data-tab="visual">
            <span class="ico">
              <svg viewBox="0 0 24 24"><path d="M9 7h6v2H9V7zm-5 3h2v7h12v-7h2v9H4v-9zm3-6h10l1 2h3v2H3V6h3l1-2z"/></svg>
            </span>
            Görsel
          </button>
        </div>

        <!-- NORMAL TAB -->
        <div id="tab-normal" class="tab">
          <div class="searchRow">
            <input id="qNormal" class="input" placeholder="Örn: ddr4 8gb ram 3200mhz" />
            <button id="btnNormalSearch" class="btn btn-primary">Ara</button>
          </div>
          <div class="hint muted">Normal arama: seçilen sitelerde arar.</div>
          <div id="normalResults" class="results"></div>
        </div>

        <!-- AI TAB -->
        <div id="tab-ai" class="tab hidden">
          <div class="searchRow">
            <input id="qAI" class="input" placeholder="Örn: ram soğutucu" />
            <button id="btnAISearch" class="btn btn-primary">AI Ara</button>
          </div>
          <div class="hint muted">
            AI Arama: her site için arama ifadesi + kısa yorum üretir. “Ara” butonu ile o sitede arar.
          </div>
          <div id="aiStatus" class="muted"></div>
          <div id="aiResults" class="results"></div>
        </div>

        <!-- VISUAL TAB -->
        <div id="tab-visual" class="tab hidden">
          <div class="visualRow">
            <div>
              <div class="row">
                <input id="imgFile" type="file" accept="image/*" />
                <button id="btnExtract" class="btn btn-primary">
                  Görselden Metin Çıkar
                </button>
              </div>
              <div class="hint muted">
                Görselden ürün/metin çıkarır → Google’da arar. Metin çıkmazsa “Google Lens” ile devam edebilirsin.
              </div>
              <div class="row">
                <button id="btnGoogleSearchText" class="btn btn-ghost" disabled>Google’da Ara</button>
                <button id="btnLens" class="btn btn-ghost">
                  <span class="ico">
                    <svg viewBox="0 0 24 24"><path d="M10 4a6 6 0 104.47 10.01l3.76 3.76 1.41-1.41-3.76-3.76A6 6 0 0010 4zm0 2a4 4 0 110 8 4 4 0 010-8z"/></svg>
                  </span>
                  Google Lens
                </button>
              </div>
              <textarea id="extractedText" class="textarea" placeholder="Çıkan metin burada..." rows="5"></textarea>
              <div id="visualErr" class="err hidden"></div>
            </div>
            <div class="preview">
              <img id="imgPreview" alt="Önizleme" />
            </div>
          </div>
        </div>
      </section>

      <!-- FAVORITES -->
      <section class="card">
        <div class="favHead">
          <div>
            <h2 class="favTitle">❤️ Favoriler</h2>
            <div class="muted">20 dk otomatik kontrol. %10+ düşüş olursa bildirim.</div>
          </div>

          <div class="favControls">
            <select id="favSort" class="select">
              <option value="relevance">Sırala: En alakalı</option>
              <option value="newest">Sırala: En yeni</option>
              <option value="priceAsc">Sırala: Son fiyat (Ucuz→Pahalı)</option>
              <option value="priceDesc">Sırala: Son fiyat (Pahalı→Ucuz)</option>
            </select>
            <button id="btnRefreshFav" class="btn btn-ghost">Yenile</button>
            <button id="btnClearLocal" class="btn btn-ghost">Cache Temizle</button>
          </div>
        </div>

        <div id="favList" class="results"></div>
        <div id="favEmpty" class="muted">Favori yok.</div>
      </section>
    </section>
  </main>

  <!-- AI SETTINGS MODAL -->
  <div id="modalBackdrop" class="modal-backdrop hidden"></div>
  <div id="aiModal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modalHead">
      <div>
        <div class="modalTitle">AI Ayarları</div>
        <div class="muted small">Sadece Gemini • PIN ile şifreli saklama</div>
      </div>
      <button id="btnCloseModal" class="btn btn-ghost">✕</button>
    </div>

    <div class="modalBody">
      <label>Gemini API Key</label>
      <input id="aiKey" class="input" placeholder="AIza..." />

      <label>PIN / Şifre</label>
      <input id="aiPin" class="input" placeholder="Sadece sen bileceksin" type="password" />

      <label class="check">
        <input id="rememberPin" type="checkbox" />
        Oturumu hatırla (PIN sadece bu oturumda tutulur)
      </label>

      <div id="aiCfgErr" class="err hidden"></div>
      <div class="row">
        <button id="btnSaveAI" class="btn btn-primary">Kaydet</button>
        <button id="btnClearAI" class="btn btn-ghost">AI Key Sil</button>
      </div>
      <div class="muted small">AI key kayıtlı. PIN doğruysa AI arama çalışır.</div>
    </div>
  </div>

  <script type="module" src="./app.js"></script>
</body>
</html>
